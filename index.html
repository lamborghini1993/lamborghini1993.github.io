<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">


  <meta name="google-site-verification" content="Ghr6aD252GAMqEPJWrLtK8o9tJM55LpSUnCdvJ39d-4">








  <meta name="baidu-site-verification" content="nsr422yhpo">







  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  
    
      
    

    
  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Monda:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|Lobster Two:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/picture/Head.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/picture/Head.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/picture/Head.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT">










<meta name="description" content="人生苦短、我用python">
<meta property="og:type" content="website">
<meta property="og:title" content="Xiao❤Hao">
<meta property="og:url" content="http://lamborghini1993.github.io/index.html">
<meta property="og:site_name" content="Xiao❤Hao">
<meta property="og:description" content="人生苦短、我用python">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Xiao❤Hao">
<meta name="twitter:description" content="人生苦短、我用python">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://lamborghini1993.github.io/">





  <title>Xiao❤Hao</title>
  








</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Xiao❤Hao</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">求知若渴 虚心若愚</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br>
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lamborghini1993.github.io/python/PyQt5/PyQt5/安装PyQt5-tools之后designer打开失败/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XiaoHao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/picture/Head.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao❤Hao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/python/PyQt5/PyQt5/安装PyQt5-tools之后designer打开失败/" itemprop="url">安装PyQt5-tools之后designer打开失败</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-05-13T14:32:25+08:00">
                2020-05-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/python/PyQt5/" itemprop="url" rel="index">
                    <span itemprop="name">PyQt5</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/python/PyQt5/PyQt5/安装PyQt5-tools之后designer打开失败/" class="leancloud_visitors" data-flag-title="安装PyQt5-tools之后designer打开失败">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>运行命令<code>pip install pyqt5-tools</code>安装qtdesigner，双击<code>site-packages\pyqt5_tools\Qt\bin\designer.exe</code>发现打不开</p>
<p><img src="/image/python/qtdesigner_open_error.png" alt="qtdesigner打开失败"></p>
<p>版本如下：<br>| 软件     | 版本  |<br>| :——-: | :——-: |<br>| python      |   3.8.2   |<br>| PyQt5      |   5.14.2   |<br>| PyQt5-sip      |   12.7.2   |<br>| pyqt5-tools      |   5.14.2.1.7b3   |</p>
<h1 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h1><p>从命令中我们得知找不到Qt插件目录，所以我们在系统变量里面添加一个参数<code>QT_PLUGIN_PATH</code><br><img src="/image/python/qtdesigner_add_path.png" alt="qtdesigner_add_path"></p>
<p>添加完毕之后打开正常</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lamborghini1993.github.io/tool/sphinx/tool/sphinx生成api文档/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XiaoHao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/picture/Head.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao❤Hao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/tool/sphinx/tool/sphinx生成api文档/" itemprop="url">sphinx生成api文档</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2020-01-14T20:31:45+08:00">
                2020-01-14
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tool/" itemprop="url" rel="index">
                    <span itemprop="name">tool</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/tool/sphinx/" itemprop="url" rel="index">
                    <span itemprop="name">sphinx</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/tool/sphinx/tool/sphinx生成api文档/" class="leancloud_visitors" data-flag-title="sphinx生成api文档">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="1-安装sphinx"><a href="#1-安装sphinx" class="headerlink" title="1.安装sphinx"></a>1.安装sphinx</h1><p><code>pip3 install sphinx</code></p>
<h1 id="2-设置文档来源"><a href="#2-设置文档来源" class="headerlink" title="2.设置文档来源"></a>2.设置文档来源</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">➜  Sphinx git:(master) ✗ sphinx-quickstart</span><br><span class="line">欢迎使用 Sphinx 2.3.1 快速配置工具。</span><br><span class="line"></span><br><span class="line">请输入接下来各项设置的值（如果方括号中指定了默认值，直接</span><br><span class="line">按回车即可使用默认值）。</span><br><span class="line"></span><br><span class="line">已选择根路径：.</span><br><span class="line"></span><br><span class="line">布置用于保存 Sphinx 输出的构建目录，有两种选择。</span><br><span class="line">一是在根路径下创建“_build”目录，二是在根路径下创建“source”</span><br><span class="line">和“build”两个独立的目录。</span><br><span class="line"><span class="meta">&gt;</span> 独立的源文件和构建目录（y/n） [n]: y</span><br><span class="line"></span><br><span class="line">项目名称会出现在文档的许多地方。</span><br><span class="line"><span class="meta">&gt;</span> 项目名称: ProjectName</span><br><span class="line"><span class="meta">&gt;</span> 作者名称: xiaohao</span><br><span class="line"><span class="meta">&gt;</span> 项目发行版本 []: </span><br><span class="line"></span><br><span class="line">If the documents are to be written in a language other than English,</span><br><span class="line">you can select a language here by its language code. Sphinx will then</span><br><span class="line">translate text that it generates into that language.</span><br><span class="line"></span><br><span class="line">For a list of supported codes, see</span><br><span class="line">https://www.sphinx-doc.org/en/master/usage/configuration.html#confval-language.</span><br><span class="line"><span class="meta">&gt;</span> 项目语种 [en]: cn</span><br><span class="line"></span><br><span class="line">创建文件 ./source/conf.py。</span><br><span class="line">创建文件 ./source/index.rst。</span><br><span class="line">创建文件 ./Makefile。</span><br><span class="line">创建文件 ./make.bat。</span><br><span class="line"></span><br><span class="line">完成：已创建初始目录结构。</span><br><span class="line"></span><br><span class="line">你现在可以填写主文档文件 ./source/index.rst 并创建其他文档源文件了。 用 Makefile 构建文档，像这样：</span><br><span class="line"> make builder</span><br><span class="line">此处的“builder”是支持的构建器名，比如 html、latex 或 linkcheck。</span><br></pre></td></tr></table></figure>
<h1 id="3-运行构建"><a href="#3-运行构建" class="headerlink" title="3.运行构建"></a>3.运行构建</h1><p>现在，您已经添加了一些文件和内容，让我们开始构建文档。使用sphinx-build程序开始构建：</p>
<p><code>sphinx-build -b html sourcedir builddir</code></p>
<p>其中sourcedir是源目录，而builddir是您要在其中放置构建文档的目录。该-b选项选择一个构建器；在此示例中，Sphinx将构建HTML文件。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">➜  Sphinx git:(master) ✗ sphinx-build -b html source build </span><br><span class="line">正在运行 Sphinx v2.3.1</span><br><span class="line">正在加载翻译 [cn]... 没有内置信息的翻译</span><br><span class="line">构建 [mo]： 0 个 po 文件的目标文件已过期</span><br><span class="line">构建 [html]： 1 个源文件的目标文件已过期</span><br><span class="line">更新环境: [新配置] 已添加 1，0 已更改，0 已移除</span><br><span class="line">阅读源... [100%] index                                                             </span><br><span class="line">查找当前已过期的文件... 没有找到</span><br><span class="line">pickling环境... 完成</span><br><span class="line">检查一致性... 完成</span><br><span class="line">准备文件... 完成</span><br><span class="line">写入输出... [100%] index                                                            </span><br><span class="line">generating indices...  genindex完成</span><br><span class="line">writing additional pages...  search完成</span><br><span class="line">复制静态文件... ... 完成</span><br><span class="line">copying extra files... 完成</span><br><span class="line">dumping search index in English (code: en)... 完成</span><br><span class="line">dumping object inventory... 完成</span><br><span class="line">构建 成功.</span><br><span class="line"></span><br><span class="line">HTML 页面保存在 build 目录。</span><br></pre></td></tr></table></figure>
<p>sphinx-quickstart脚本会创建Makefile和， make.bat这会使您的生活更加轻松。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">➜  Sphinx git:(master) ✗ make html</span><br><span class="line">正在运行 Sphinx v2.3.1</span><br><span class="line">正在加载翻译 [cn]... 没有内置信息的翻译</span><br><span class="line">制作输出目录... 完成</span><br><span class="line">构建 [mo]： 0 个 po 文件的目标文件已过期</span><br><span class="line">构建 [html]： 1 个源文件的目标文件已过期</span><br><span class="line">更新环境: [新配置] 已添加 1，0 已更改，0 已移除</span><br><span class="line">阅读源... [100%] index                                                             </span><br><span class="line">查找当前已过期的文件... 没有找到</span><br><span class="line">pickling环境... 完成</span><br><span class="line">检查一致性... 完成</span><br><span class="line">准备文件... 完成</span><br><span class="line">写入输出... [100%] index                                                            </span><br><span class="line">generating indices...  genindex完成</span><br><span class="line">writing additional pages...  search完成</span><br><span class="line">复制静态文件... ... 完成</span><br><span class="line">copying extra files... 完成</span><br><span class="line">dumping search index in English (code: en)... 完成</span><br><span class="line">dumping object inventory... 完成</span><br><span class="line">构建 成功.</span><br><span class="line"></span><br><span class="line">HTML 页面保存在 build/html 目录。</span><br></pre></td></tr></table></figure>
<h1 id="4-调用-sphinx-apidoc"><a href="#4-调用-sphinx-apidoc" class="headerlink" title="4.调用 sphinx-apidoc"></a>4.调用 sphinx-apidoc</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  Sphinx git:(master) ✗ sphinx-apidoc -o ./source/src ./Script</span><br><span class="line">创建文件 ./source/src/test.rst。</span><br><span class="line">创建文件 ./source/src/modules.rst。</span><br></pre></td></tr></table></figure>
<h1 id="5-支持md文件"><a href="#5-支持md文件" class="headerlink" title="5. 支持md文件"></a>5. 支持md文件</h1><p><code>pip install recommonmark</code></p>
<p>在conf.py添加扩支持：</p>
<p>extensions = [‘recommonmark’]</p>
<h1 id="6-vscode支持rst预览"><a href="#6-vscode支持rst预览" class="headerlink" title="6. vscode支持rst预览"></a>6. vscode支持rst预览</h1><p>reStructuredText插件 + <code>pip install doc8</code></p>
<h1 id="7-重点配置说明"><a href="#7-重点配置说明" class="headerlink" title="7. 重点配置说明"></a>7. 重点配置说明</h1><h2 id="1-源码路径"><a href="#1-源码路径" class="headerlink" title="1. 源码路径"></a>1. 源码路径</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import sys</span><br><span class="line">sys.path.insert(0, os.path.abspath(&apos;../Script&apos;))</span><br></pre></td></tr></table></figure>
<p>这里需要添加python生成api文档的源码路径，一定要绝对路径，所以使用<code>abspath</code></p>
<h2 id="2-一些常用插件"><a href="#2-一些常用插件" class="headerlink" title="2. 一些常用插件"></a>2. 一些常用插件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">extensions = [</span><br><span class="line">    &quot;sphinx.ext.autodoc&quot;,       # 标准的Python模块扩展,为Sphinx提供的附加功能</span><br><span class="line">    &quot;recommonmark&quot;,             # markdown支持</span><br><span class="line">    &quot;sphinx_markdown_tables&quot;,   # markdown表格支持</span><br><span class="line">    &quot;sphinx.ext.napoleon&quot;,      # 支持numpy和google风格的docstrings</span><br><span class="line">    &quot;sphinx.ext.intersphinx&quot;,   # 启用链接</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="3-python官方主题"><a href="#3-python官方主题" class="headerlink" title="3. python官方主题"></a>3. python官方主题</h2><p><code>html_theme = &#39;sphinx_rtd_theme&#39;</code></p>
<h1 id="8-关于init-py的坑"><a href="#8-关于init-py的坑" class="headerlink" title="8. 关于init.py的坑"></a>8. 关于<strong>init</strong>.py的坑</h1><p>如果源码中存在<code>__init__.py</code>，那么sphinx会将其当成一个模块来看<br>所以在添加<code>sys.path.insert(0, os.path.abspath(&#39;../&#39;))</code>的时候需要在脚本的外层路径（此时将脚本当成一个包）</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lamborghini1993.github.io/python3/python3/python3单例模式以及坑点/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XiaoHao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/picture/Head.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao❤Hao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/python3/python3/python3单例模式以及坑点/" itemprop="url">python3单例模式以及坑点</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-12-04T20:03:24+08:00">
                2019-12-04
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/python3/" itemprop="url" rel="index">
                    <span itemprop="name">python3</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/python3/python3/python3单例模式以及坑点/" class="leancloud_visitors" data-flag-title="python3单例模式以及坑点">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一、几种单例模式的实现"><a href="#一、几种单例模式的实现" class="headerlink" title="一、几种单例模式的实现"></a>一、几种单例模式的实现</h1><h2 id="1-使用装饰器"><a href="#1-使用装饰器" class="headerlink" title="1. 使用装饰器"></a>1. 使用装饰器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">def Singleton(cls):</span><br><span class="line">    _instance = &#123;&#125;</span><br><span class="line"></span><br><span class="line">    def _single(*args, **kwargs):</span><br><span class="line">        if cls not in _instance:</span><br><span class="line">            _instance[cls] = cls(*args, **kwargs)</span><br><span class="line">        return _instance[cls]</span><br><span class="line"></span><br><span class="line">    return _single</span><br><span class="line"></span><br><span class="line">@Singleton</span><br><span class="line">class A:</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">A()</span><br></pre></td></tr></table></figure>
<h2 id="2-使用类方法"><a href="#2-使用类方法" class="headerlink" title="2. 使用类方法"></a>2. 使用类方法</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class Singleton(object):</span><br><span class="line"></span><br><span class="line">    @classmethod</span><br><span class="line">    def instance(cls, *args, **kwargs):</span><br><span class="line">        if not hasattr(cls, &quot;_instance&quot;):</span><br><span class="line">            cls._instance = cls(*args, **kwargs)</span><br><span class="line">        return cls._instance</span><br><span class="line"></span><br><span class="line">class A(Singleton):</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">A.instance()</span><br></pre></td></tr></table></figure>
<h2 id="3-使用new-推荐"><a href="#3-使用new-推荐" class="headerlink" title="3. 使用new(推荐)"></a>3. 使用<strong>new</strong>(推荐)</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class Singleton(object):</span><br><span class="line">    _instance = None</span><br><span class="line"></span><br><span class="line">    def __new__(cls, *args, **kwargs):</span><br><span class="line">        if not cls._instance:</span><br><span class="line">            cls._instance = object.__new__(cls)</span><br><span class="line">        return cls._instance</span><br><span class="line"></span><br><span class="line">class A(Singleton):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">A()</span><br></pre></td></tr></table></figure>
<h1 id="二、几个坑点"><a href="#二、几个坑点" class="headerlink" title="二、几个坑点"></a>二、几个坑点</h1><h2 id="1-使用new方式会多次调用init"><a href="#1-使用new方式会多次调用init" class="headerlink" title="1.使用new方式会多次调用init"></a>1.使用<strong>new</strong>方式会多次调用<strong>init</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class Singleton(object):</span><br><span class="line">    _instance = None</span><br><span class="line"></span><br><span class="line">    def __new__(cls, *args, **kwargs):</span><br><span class="line">        if not cls._instance:</span><br><span class="line">            cls._instance = object.__new__(cls)</span><br><span class="line">        return cls._instance</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class A(Singleton):</span><br><span class="line">    M = 1</span><br><span class="line"></span><br><span class="line">    def __init__(self, a):</span><br><span class="line">        print(&quot;init&quot;, a, self.M)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">for i in range(5):</span><br><span class="line">    A(i)</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">➜ python3 test.py</span><br><span class="line">init 0 1</span><br><span class="line">init 1 1</span><br><span class="line">init 2 1</span><br><span class="line">init 3 1</span><br><span class="line">init 4 1</span><br></pre></td></tr></table></figure>
<p>所以在<strong>init</strong>里面做初始化逻辑的类需要注意，自己处理一下或者使用其他两种方式</p>
<h2 id="2-关于单例类多继承问题"><a href="#2-关于单例类多继承问题" class="headerlink" title="2.关于单例类多继承问题"></a>2.关于单例类多继承问题</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class Singleton(object):</span><br><span class="line">    _instance = None</span><br><span class="line"></span><br><span class="line">    def __new__(cls, *args, **kwargs):</span><br><span class="line">        if not Singleton._instance:</span><br><span class="line">            Singleton._instance = object.__new__(cls)</span><br><span class="line">        print(cls, Singleton._instance) #</span><br><span class="line">        return Singleton._instance</span><br></pre></td></tr></table></figure>
<ul>
<li>看到网上有这样的一种写法</li>
<li>运行起来没什么问题，但是到类有继承关系的时候就会出问题<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">class A(Singleton):</span><br><span class="line">   ...</span><br><span class="line"></span><br><span class="line">class B(Singleton):</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line">A()</span><br><span class="line">B()</span><br></pre></td></tr></table></figure>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">➜  python3 test.py</span><br><span class="line">&lt;class '__main__.A'&gt; &lt;__main__.A object at 0x7f9d1c8dab70&gt;</span><br><span class="line">&lt;class '__main__.B'&gt; &lt;__main__.A object at 0x7f9d1c8dab70&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>可以发现A类和B类生成的实例对象是同一个</li>
<li>但是常规的应该是两种不同的单例对象，应该不一样（当然也有可能有该需求，可以使用此方法）</li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lamborghini1993.github.io/python/python3/类型注解/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XiaoHao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/picture/Head.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao❤Hao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/python/python3/类型注解/" itemprop="url">python3类型注解</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-09-10T10:03:24+08:00">
                2019-09-10
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/python/python3/类型注解/" class="leancloud_visitors" data-flag-title="python3类型注解">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="一、类型注解说明"><a href="#一、类型注解说明" class="headerlink" title="一、类型注解说明"></a>一、类型注解说明</h1><p>我们知道 Python 是一种动态语言，变量以及函数的参数是<strong>不区分类型</strong>。因此我们定义函数只需要这样写就可以了：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x, y)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br></pre></td></tr></table></figure>
<p>坏处就是对于别人代码，无法一眼判断出参数的类型，IDE 也无法给出正确的提示。所以python3.5+就提供了类型注解：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x: int, y: int)</span> -&gt; int:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br></pre></td></tr></table></figure>
<p>用 <code>: 类型</code> 的形式指定函数的<strong>参数类型</strong>，用 <code>-&gt; 类型</code> 的形式指定函数的<strong>返回值</strong>类型。</p>
<p>Python 解释器<strong>并不会</strong>因为这些注解而提供额外的校验，没有任何的类型检查工作。也就是说，这些类型注解加不加，对你的代码来说<strong>没有任何影响</strong>。</p>
<p>类型注解的好处：</p>
<ol>
<li>让别的程序员看得更明白。</li>
<li>让 IDE 了解类型，从而提供更准确的代码提示、补全和语法检查（包括类型检查）。</li>
</ol>
<p>在函数的 <code>__annotations__</code> 属性中会有你设定的注解：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x: int, y: int)</span> -&gt; int:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line"></span><br><span class="line">print(add.__annotations__)</span><br></pre></td></tr></table></figure>
<p>输出：</p>
<p><code>{&#39;x&#39;: &lt;class &#39;int&#39;&gt;, &#39;y&#39;: &lt;class &#39;int&#39;&gt;, &#39;return&#39;: &lt;class &#39;int&#39;&gt;}</code></p>
<h1 id="二、类型标注支持"><a href="#二、类型标注支持" class="headerlink" title="二、类型标注支持"></a>二、类型标注支持</h1><h2 id="1-函数参数以及返回值"><a href="#1-函数参数以及返回值" class="headerlink" title="1.函数参数以及返回值"></a>1.函数参数以及返回值</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x: int, y: int)</span> -&gt; int:</span></span><br><span class="line">    <span class="keyword">return</span> x + y</span><br></pre></td></tr></table></figure>
<h2 id="2-变量（3-6-后支持）"><a href="#2-变量（3-6-后支持）" class="headerlink" title="2.变量（3.6+后支持）"></a>2.变量（3.6+后支持）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> List</span><br><span class="line">info = &#123;<span class="string">"a"</span>: <span class="number">1</span>, <span class="string">"b"</span>: <span class="string">"b"</span>&#125;</span><br><span class="line">a: int = info[<span class="string">"a"</span>]</span><br><span class="line">b: str = info[<span class="string">"b"</span>]</span><br><span class="line">l: List[int] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br></pre></td></tr></table></figure>
<h2 id="3-Any类型"><a href="#3-Any类型" class="headerlink" title="3. Any类型"></a>3. Any类型</h2><p><a href="https://docs.python.org/zh-cn/3/library/typing.html#typing.Any" target="_blank" rel="noopener"><code>Any</code></a> 是一种特殊的类型。静态类型检查器将所有类型视为与 <a href="https://docs.python.org/zh-cn/3/library/typing.html#typing.Any" target="_blank" rel="noopener"><code>Any</code></a> 兼容，反之亦然， <a href="https://docs.python.org/zh-cn/3/library/typing.html#typing.Any" target="_blank" rel="noopener"><code>Any</code></a> 也与所有类型相兼容。</p>
<p>这意味着可对类型为 <a href="https://docs.python.org/zh-cn/3/library/typing.html#typing.Any" target="_blank" rel="noopener"><code>Any</code></a> 的值执行任何操作或方法调用，并将其赋值给任何变量:一般用于不确定的返回值上。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Any</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(item: Any)</span>-&gt;Any:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h2 id="4-object类型"><a href="#4-object类型" class="headerlink" title="4. object类型"></a>4. object类型</h2><p>与 <a href="https://docs.python.org/zh-cn/3/library/typing.html#typing.Any" target="_blank" rel="noopener"><code>Any</code></a> 相似，所有的类型都是 <a href="https://docs.python.org/zh-cn/3/library/functions.html#object" target="_blank" rel="noopener"><code>object</code></a> 的子类型。然而不同于 <a href="https://docs.python.org/zh-cn/3/library/typing.html#typing.Any" target="_blank" rel="noopener"><code>Any</code></a>，反之并不成立： <a href="https://docs.python.org/zh-cn/3/library/functions.html#object" target="_blank" rel="noopener"><code>object</code></a> <em>不是</em> 其他所有类型的子类型。</p>
<p>这意味着当一个值的类型是 <a href="https://docs.python.org/zh-cn/3/library/functions.html#object" target="_blank" rel="noopener"><code>object</code></a> 的时候，类型检查器会拒绝对它的几乎所有的操作。把它赋值给一个指定了类型的变量（或者当作返回值）是一个类型错误。比如说：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(item: object)</span> -&gt; int:</span></span><br><span class="line">    <span class="comment"># mypy test.py会输出：error: "object" has no attribute "magic"</span></span><br><span class="line">    item.magic()</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>使用 <a href="https://docs.python.org/zh-cn/3/library/functions.html#object" target="_blank" rel="noopener"><code>object</code></a> 示意一个值可以类型安全地兼容任何类型。使用 <a href="https://docs.python.org/zh-cn/3/library/typing.html#typing.Any" target="_blank" rel="noopener"><code>Any</code></a> 示意一个值地类型是动态定义的。</p>
<h1 id="三、高级用法"><a href="#三、高级用法" class="headerlink" title="三、高级用法"></a>三、高级用法</h1><h2 id="1-类型别名"><a href="#1-类型别名" class="headerlink" title="1.类型别名"></a>1.类型别名</h2><p>类型别名通过将类型分配给别名来定义，用于简化复杂类型注解。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Dict, Tuple, Sequence</span><br><span class="line"></span><br><span class="line">ConnectionOptions = Dict[str, str]</span><br><span class="line">Address = Tuple[str, int]</span><br><span class="line">Server = Tuple[Address, ConnectionOptions]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">broadcast_message</span><span class="params">(message: str, servers: Sequence[Server])</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<p>等同于以下注解：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">broadcast_message</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">    message: str,</span></span></span><br><span class="line"><span class="function"><span class="params">    servers: Sequence[Tuple[Tuple[str, int], Dict[str, str]]])</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h2 id="2-Callable"><a href="#2-Callable" class="headerlink" title="2.Callable"></a>2.Callable</h2><p>期望特定签名的回调函数的框架可以将类型标注为 <code>Callable[[Arg1Type, Arg2Type], ReturnType]</code>。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Callable</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">feeder</span><span class="params">(cbfun: Callable[[], str])</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">async_query</span><span class="params">(on_success: Callable[[int], None],</span></span></span><br><span class="line"><span class="function"><span class="params">                on_error: Callable[[int, Exception], None])</span> -&gt; <span class="keyword">None</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>
<h2 id="3-多类型注解"><a href="#3-多类型注解" class="headerlink" title="3.多类型注解"></a>3.多类型注解</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> Union</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun</span><span class="params">(i: Union[str, int])</span>-&gt;Union[str, int]:</span></span><br><span class="line">    <span class="keyword">return</span> i * <span class="number">2</span></span><br></pre></td></tr></table></figure>
<h1 id="四、类型注解检测"><a href="#四、类型注解检测" class="headerlink" title="四、类型注解检测"></a>四、类型注解检测</h1><p>通过 <strong>mypy</strong> 库来检验最终代码是否符合注解。mypy是一个Python命令行应用 (Python command line application )，可以轻松集成到我们的代码流中。</p>
<p>需要安装：<code>pip isntall mypy</code></p>
<p>例如：test.py有以下内容</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tmp: int = <span class="string">"test"</span></span><br></pre></td></tr></table></figure>
<p>执行命令：<code>mypy test.py</code></p>
<p>如果类型都符合，则不会有任何输出，否则就会给出类似输出：</p>
<p><code>test.py:1: error: Incompatible types in assignment (expression has type &quot;str&quot;, variable has type &quot;int&quot;)</code></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lamborghini1993.github.io/LeetCode/LeetCode/LeetCode-C++/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XiaoHao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/picture/Head.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao❤Hao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/LeetCode/LeetCode/LeetCode-C++/" itemprop="url">LeetCode-C++</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-16T20:57:43+08:00">
                2019-05-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index">
                    <span itemprop="name">LeetCode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/LeetCode/LeetCode/LeetCode-C++/" class="leancloud_visitors" data-flag-title="LeetCode-C++">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="模板"><a href="#模板" class="headerlink" title="模板"></a>模板</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;climits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="二维数组初始化"><a href="#二维数组初始化" class="headerlink" title="二维数组初始化"></a>二维数组初始化</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> h = <span class="number">5</span>, w = <span class="number">8</span>;</span><br><span class="line"><span class="keyword">char</span> xh[h][w] = &#123;&#123;<span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>&#125;,</span><br><span class="line">                &#123;<span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'0'</span>&#125;,</span><br><span class="line">                &#123;<span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'0'</span>&#125;,</span><br><span class="line">                &#123;<span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'0'</span>, <span class="string">'0'</span>, <span class="string">'0'</span>&#125;,</span><br><span class="line">                &#123;<span class="string">'0'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'1'</span>, <span class="string">'0'</span>, <span class="string">'0'</span>, <span class="string">'0'</span>&#125;&#125;;</span><br><span class="line"><span class="comment">// 赋值给vector</span></span><br><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt;&gt; matrix;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; h; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">char</span>&gt; tmp(xh[i], xh[i] + w);</span><br><span class="line">    matrix.push_back(tmp);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="二维vector"><a href="#二维vector" class="headerlink" title="二维vector"></a>二维vector</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">vector</span>&lt;<span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;&gt; dp(N, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt;(M));</span><br></pre></td></tr></table></figure>
<h1 id="github"><a href="#github" class="headerlink" title="github"></a>github</h1><ul>
<li><a href="https://github.com/lamborghini1993/LeetCode" target="_blank" rel="noopener">https://github.com/lamborghini1993/LeetCode</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lamborghini1993.github.io/LeetCode/LeetCode/LeetCode-710-random-pick-with-blacklist/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XiaoHao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/picture/Head.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao❤Hao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/LeetCode/LeetCode/LeetCode-710-random-pick-with-blacklist/" itemprop="url">LeetCode-710-random-pick-with-blacklist</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-16T20:45:36+08:00">
                2019-05-16
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index">
                    <span itemprop="name">LeetCode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/LeetCode/LeetCode/LeetCode-710-random-pick-with-blacklist/" class="leancloud_visitors" data-flag-title="LeetCode-710-random-pick-with-blacklist">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="题目地址"><a href="#题目地址" class="headerlink" title="题目地址"></a>题目地址</h1><ul>
<li>英文：<a href="https://leetcode.com/problems/random-pick-with-blacklist/" target="_blank" rel="noopener">https://leetcode.com/problems/random-pick-with-blacklist/</a></li>
<li>中文：<a href="https://leetcode-cn.com/problems/random-pick-with-blacklist/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/random-pick-with-blacklist/</a></li>
</ul>
<h1 id="题意："><a href="#题意：" class="headerlink" title="题意："></a>题意：</h1><p>给你一个整数N，一个黑名单B的列表，让你从[0,n)中随机产生一个不在B列表中的数。</p>
<h1 id="解题思路一："><a href="#解题思路一：" class="headerlink" title="解题思路一："></a>解题思路一：</h1><p>排序B列表，然后新建一个白名单列表0到n-1依次开始添加，如果在黑名单中就跳过。</p>
<ul>
<li>C++ 代码超时</li>
<li>python 代码超内存</li>
</ul>
<!--c++0-->
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;climits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; p;</span><br><span class="line">    <span class="keyword">int</span> size;</span><br><span class="line">    Solution(<span class="keyword">int</span> N, <span class="built_in">vector</span>&lt;<span class="keyword">int</span>&gt; blacklist)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (blacklist.size() != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            sort(blacklist.begin(), blacklist.end());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; N; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span> (j &lt; blacklist.size() &amp;&amp; blacklist[j] &lt; i)</span><br><span class="line">            &#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(j&gt;=blacklist.size() || blacklist[j]!=i)</span><br><span class="line">                p.push_back(i);</span><br><span class="line">        &#125;</span><br><span class="line">        size = p.size();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="built_in">printf</span>(<span class="string">"%d "</span>,p[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"\n"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">pick</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> p[rand() % size];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Your Solution object will be instantiated and called as such:</span></span><br><span class="line"><span class="comment"> * Solution obj = new Solution(N, blacklist);</span></span><br><span class="line"><span class="comment"> * int param_1 = obj.pick();</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>
<!--python1-->
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, N, blacklist)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type N: int</span></span><br><span class="line"><span class="string">        :type blacklist: List[int]</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.m_WhiteList = list(set(range(N)).difference(set(blacklist)))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pick</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="keyword">return</span> random.choice(self.m_WhiteList)</span><br><span class="line"></span><br><span class="line"><span class="comment"># o = Solution(15, [3, 6, 2, 13, 4])</span></span><br><span class="line"><span class="comment"># for x in range(10):</span></span><br><span class="line"><span class="comment">#     print(o.pick())</span></span><br></pre></td></tr></table></figure>
<h1 id="解题思路二："><a href="#解题思路二：" class="headerlink" title="解题思路二："></a>解题思路二：</h1><p>我们可以对黑名单做一个白名单的映射表，比如：N = 15， B = [3, 6, 2, 13, 4]<br>最终的白名单个数为 <code>N - len(B) = 10</code>,所以可得如下映射表<code>map</code>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    3: 14,</span><br><span class="line">    6: 13,</span><br><span class="line">    2: 12,</span><br><span class="line">    13: 11,</span><br><span class="line">    4: 10,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>所以此时可的这样的对应关系：<br><code>0-0 1-1 2-2 3-14 4-10 5-5 6-13 7-7 8-8 9-9</code><br>最终的结果就是<code>map.get(x,x)</code></p>
<!--python0-->
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span><span class="params">(object)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, N, blacklist)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :type N: int</span></span><br><span class="line"><span class="string">        :type blacklist: List[int]</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        self.m_Map = &#123;&#125;</span><br><span class="line">        self.m_Size = N-len(blacklist)</span><br><span class="line">        replace = N<span class="number">-1</span></span><br><span class="line">        <span class="comment"># 建立黑名单中的替代路径</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> blacklist:</span><br><span class="line">            self.m_Map.setdefault(n, replace)</span><br><span class="line">            replace -= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># 路径压缩</span></span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> blacklist:</span><br><span class="line">            <span class="keyword">if</span> n &gt;= self.m_Size:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">if</span> n <span class="keyword">in</span> self.m_Map:</span><br><span class="line">                nxt = self.m_Map[n]</span><br><span class="line">                <span class="keyword">while</span> nxt <span class="keyword">in</span> self.m_Map:</span><br><span class="line">                    nxt = self.m_Map[nxt]</span><br><span class="line">                self.m_Map[n] = nxt</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">pick</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        :rtype: int</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        rd = int(random.random()*self.m_Size)</span><br><span class="line">        <span class="keyword">return</span> self.m_Map.get(rd, rd)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># o = Solution(15, [3, 6, 2, 13, 4])</span></span><br><span class="line"><span class="comment"># for x in range(10):</span></span><br><span class="line"><span class="comment">#     print(o.pick())</span></span><br></pre></td></tr></table></figure>
<h1 id="github"><a href="#github" class="headerlink" title="github"></a>github</h1><ul>
<li><a href="https://github.com/lamborghini1993/LeetCode" target="_blank" rel="noopener">https://github.com/lamborghini1993/LeetCode</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lamborghini1993.github.io/python/python3/python3中super的顺序/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XiaoHao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/picture/Head.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao❤Hao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/python/python3/python3中super的顺序/" itemprop="url">python3中super的顺序</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-13T20:03:24+08:00">
                2019-03-13
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/python/python3/python3中super的顺序/" class="leancloud_visitors" data-flag-title="python3中super的顺序">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h1><p>我们都知道python中允许多继承，使用super来调用父类，但是对于多继承的顺序总是弄不清楚，所以自己写了代码来弄清楚一下具体顺序。</p>
<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A1</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(A1, self).__init__()</span><br><span class="line">        print(<span class="string">"A1.__init__"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Test</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"A1.Test"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B1</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(B1, self).__init__()</span><br><span class="line">        print(<span class="string">"B1.__init__"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Test</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"B1.Test"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C1</span><span class="params">(A1, B1)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    父类__init__中有super</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(C1, self).__init__()</span><br><span class="line">        print(<span class="string">"C1.__init__"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Test</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        macro顺序为: C1 A1 B1 object</span></span><br><span class="line"><span class="string">        super方式无法调用B.Test</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        super(C1, self).Test()</span><br><span class="line">        print(<span class="string">"C1.Test"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#########################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A2</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"A2.__init__"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Test</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"A2.Test"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B2</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"B2.__init__"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Test</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"B2.Test"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C2</span><span class="params">(A2, B2)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    父类__init__中无super</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        super(C2, self).__init__()</span><br><span class="line">        print(<span class="string">"C2.__init__"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Test</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        macro顺序为: C2 A2 B2 object</span></span><br><span class="line"><span class="string">        super方式无法调用B.Test</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        super(C2, self).Test()</span><br><span class="line">        print(<span class="string">"C2.Test"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#########################################</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AA</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"AA.__init__"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Test</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"AA.Test"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BB</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"BB.__init__"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Test</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">"BB.Test"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CC</span><span class="params">(AA, BB)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        AA.__init__(self)</span><br><span class="line">        BB.__init__(self)</span><br><span class="line">        print(<span class="string">"CC.__init__"</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Test</span><span class="params">(self)</span>:</span></span><br><span class="line">        AA.Test(self)</span><br><span class="line">        BB.Test(self)</span><br><span class="line">        print(<span class="string">"CC.Test"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    C1().Test()</span><br><span class="line">    print(C1.mro())</span><br><span class="line">    print(<span class="string">"-"</span> * <span class="number">50</span>)</span><br><span class="line">    C2().Test()</span><br><span class="line">    print(C2.mro())</span><br><span class="line">    print(<span class="string">"-"</span> * <span class="number">50</span>)</span><br><span class="line">    CC().Test()</span><br><span class="line">    print(CC.mro())</span><br></pre></td></tr></table></figure>
<h1 id="输出结果"><a href="#输出结果" class="headerlink" title="输出结果"></a>输出结果</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">B1.__init__</span><br><span class="line">A1.__init__</span><br><span class="line">C1.__init__</span><br><span class="line">A1.Test</span><br><span class="line">C1.Test</span><br><span class="line">[&lt;class &apos;__main__.C1&apos;&gt;, &lt;class &apos;__main__.A1&apos;&gt;, &lt;class &apos;__main__.B1&apos;&gt;, &lt;class &apos;object&apos;&gt;]</span><br><span class="line">--------------------------------------------------</span><br><span class="line">A2.__init__</span><br><span class="line">C2.__init__</span><br><span class="line">A2.Test</span><br><span class="line">C2.Test</span><br><span class="line">[&lt;class &apos;__main__.C2&apos;&gt;, &lt;class &apos;__main__.A2&apos;&gt;, &lt;class &apos;__main__.B2&apos;&gt;, &lt;class &apos;object&apos;&gt;]</span><br><span class="line">--------------------------------------------------</span><br><span class="line">AA.__init__</span><br><span class="line">BB.__init__</span><br><span class="line">CC.__init__</span><br><span class="line">AA.Test</span><br><span class="line">BB.Test</span><br><span class="line">CC.Test</span><br><span class="line">[&lt;class &apos;__main__.CC&apos;&gt;, &lt;class &apos;__main__.AA&apos;&gt;, &lt;class &apos;__main__.BB&apos;&gt;, &lt;class &apos;object&apos;&gt;]</span><br></pre></td></tr></table></figure>
<ol>
<li>第一种A和B的__init__中都调用了super方法，此时在C中调用super，发现先输出B，再输出A。而Test2调用只输出了A。</li>
<li>第二种A和B的__init__中都没调用super方法，此时在C中调用super，发现只输出A。而Test2调用也只输出了A。</li>
<li>第三张我们不用super，改用cls.Method调用，这个好理解，直接按照我们调用的顺序输出，Test2也一样。</li>
</ol>
<h1 id="MRO算法"><a href="#MRO算法" class="headerlink" title="MRO算法"></a>MRO算法</h1><p>这里也大致说下MRO算法：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span><span class="params">(O)</span>:</span><span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(O)</span>:</span><span class="keyword">pass</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">C</span><span class="params">(A, B)</span>:</span><span class="keyword">pass</span></span><br></pre></td></tr></table></figure></p>
<p>此时MRO(C) = [C] + merge(mro)<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mro(C) = [C] + merge(mro(A), mro(B), [A,B])     </span><br><span class="line">            <span class="comment"># 上面这个merge这个是按照class C(A, B)中AB的顺序来的</span></span><br><span class="line">       = [C] + merge([A,O], [B,O], [A,B])</span><br></pre></td></tr></table></figure></p>
<p>执行merge操作的序列为[A,O]、[B,O]、[A,B]<br>A是序列[A,O]中的第一个元素，在序列[B,O]中不出现，在序列[A,B]中也是第一个元素，所以从执行merge操作的序列([A,O]、[B,O]、[A,B])中删除A，合并到当前mro中。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mro(C) = [C,A] + merge([O], [B,O], [B])</span><br></pre></td></tr></table></figure></p>
<p>再执行merge操作，O是序列[O]中的第一个元素，但O在序列[B,O]中出现并且不是其中第一个元素。继续查看下一个元素，也就是[B,O]的第一个元素B，B满足是所有序列中的第一个元素条件，所以从执行merge操作的序列中删除B，合并到[C, A]中。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mro(C) = [C,A,B] + merge([O], [O]) </span><br><span class="line">       = [C,A,B,O]</span><br></pre></td></tr></table></figure></p>
<p>所以C的顺序为：C、A、B、O(object)，复合上面C.mro的输出。</p>
<p>总结一下：从头开始，不断寻找满足所有出现的序列中的第一个元素，找到合并到mro中，删除所有序列中的该元素，继续寻找</p>
<h1 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h1><p>通过查找资料，发现这里的顺序是通过一个叫<a href="https://www.jianshu.com/p/a08c61abe895" target="_blank" rel="noopener">MRO算法</a>生成的，具体可以点击链接看看。</p>
<p>mro算法是求继承顺序的，所以对于一</p>
<ol>
<li>先运行A的__init__，然后A又调用super</li>
<li>运行B的__init__，然后B调用super</li>
<li>运行object的__init__。</li>
<li>打印输出B.__init__。</li>
<li>打印输出A.__init__。</li>
<li>打印输出C.__init__。</li>
</ol>
<p>对于二同理分析即可。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lamborghini1993.github.io/python/PyQt5/PyQt5/PyQt5实现多选下拉菜单/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XiaoHao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/picture/Head.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao❤Hao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/python/PyQt5/PyQt5/PyQt5实现多选下拉菜单/" itemprop="url">PyQt5实现多选下拉菜单</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-03-12T14:08:27+08:00">
                2019-03-12
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                
                  ， 
                
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/python/PyQt5/" itemprop="url" rel="index">
                    <span itemprop="name">PyQt5</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/python/PyQt5/PyQt5/PyQt5实现多选下拉菜单/" class="leancloud_visitors" data-flag-title="PyQt5实现多选下拉菜单">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="实现效果"><a href="#实现效果" class="headerlink" title="实现效果"></a>实现效果</h1><p><img src="/image/2019-03-12_DropDownMenu.gif" alt="PyQt5实现多选下拉菜单"></p>
<h1 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">@Description: 多选下拉菜单的实现</span></span><br><span class="line"><span class="string">@Author: lamborghini1993</span></span><br><span class="line"><span class="string">@Date: 2019-03-12 13:45:56</span></span><br><span class="line"><span class="string">@UpdateDate: 2019-03-12 13:58:53</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PyQt5 <span class="keyword">import</span> QtCore, QtGui, QtWidgets</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">CMyLove</span><span class="params">(QtWidgets.QWidget)</span>:</span></span><br><span class="line">    m_IDAttr = <span class="string">"m_ID"</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, parent=None)</span>:</span></span><br><span class="line">        super(CMyLove, self).__init__(parent)</span><br><span class="line">        self.m_Info = &#123;x: <span class="string">"Test_"</span>+str(x) <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">100</span>)&#125;</span><br><span class="line">        self.m_Select = []</span><br><span class="line">        self._InitUI()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_InitUI</span><span class="params">(self)</span>:</span></span><br><span class="line">        hBox = QtWidgets.QHBoxLayout(self)</span><br><span class="line">        self.m_LineEdit = QtWidgets.QLineEdit(self)</span><br><span class="line">        self.m_MenuBtn = QtWidgets.QPushButton(self)</span><br><span class="line">        hBox.addWidget(self.m_LineEdit)</span><br><span class="line">        hBox.addWidget(self.m_MenuBtn)</span><br><span class="line"></span><br><span class="line">        self.m_Menu = QtWidgets.QMenu(self)</span><br><span class="line">        <span class="keyword">for</span> ID, sInfo <span class="keyword">in</span> self.m_Info.items():</span><br><span class="line">            action = QtWidgets.QAction(sInfo, self)</span><br><span class="line">            action.setCheckable(<span class="keyword">True</span>)</span><br><span class="line">            self.m_Menu.addAction(action)</span><br><span class="line">            setattr(action, self.m_IDAttr, ID)</span><br><span class="line">            action.triggered.connect(self.S_StateChanged)</span><br><span class="line">        self.m_MenuBtn.setMenu(self.m_Menu)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">S_StateChanged</span><span class="params">(self, bChecked)</span>:</span></span><br><span class="line">        send = self.sender()</span><br><span class="line">        ID = getattr(send, self.m_IDAttr)</span><br><span class="line">        <span class="keyword">if</span> bChecked:</span><br><span class="line">            self.m_Select.append(ID)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self.m_Select.remove(ID)</span><br><span class="line">        self.m_Select = sorted(self.m_Select)</span><br><span class="line">        lstTemp = [str(x) <span class="keyword">for</span> x <span class="keyword">in</span> self.m_Select]</span><br><span class="line">        self.m_LineEdit.setText(<span class="string">"&amp;"</span>.join(lstTemp))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    app = QtWidgets.QApplication(sys.argv)</span><br><span class="line">    obj = CMyLove()</span><br><span class="line">    obj.show()</span><br><span class="line">    sys.exit(app.exec_())</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lamborghini1993.github.io/数据库/SQL/mysql索引的数据结构/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XiaoHao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/picture/Head.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao❤Hao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/数据库/SQL/mysql索引的数据结构/" itemprop="url">mysql索引的数据结构</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-02-20T19:42:15+08:00">
                2019-02-20
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/数据库/" itemprop="url" rel="index">
                    <span itemprop="name">数据库</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/数据库/SQL/mysql索引的数据结构/" class="leancloud_visitors" data-flag-title="mysql索引的数据结构">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><p>MySQL官方对索引的定义为：索引（Index）是帮助MySQL高效获取数据的数据结构。</p>
<p>我们知道，数据库查询是数据库的最主要功能之一。我们都希望查询数据的速度能尽可能的快，因此数据库系统的设计者会从查询算法的角度进行优化。最基本的查询算法当然是<a href="https://link.jianshu.com/?t=http://en.wikipedia.org/wiki/Linear_search" target="_blank" rel="noopener">顺序查找</a>（linear search），这种复杂度为O(n)的算法在数据量很大时显然是糟糕的，好在计算机科学的发展提供了很多更优秀的查找算法，例如<a href="https://link.jianshu.com/?t=http://en.wikipedia.org/wiki/Binary_search_algorithm" target="_blank" rel="noopener">二分查找</a>（binary search）、<a href="https://link.jianshu.com/?t=http://en.wikipedia.org/wiki/Binary_search_tree" target="_blank" rel="noopener">二叉树查找</a>（binary tree search）等。如果稍微分析一下会发现，每种查找算法都只能应用于特定的数据结构之上，例如二分查找要求被检索数据有序，而二叉树查找只能应用于<a href="https://link.jianshu.com/?t=http://en.wikipedia.org/wiki/Binary_search_tree" target="_blank" rel="noopener">二叉查找树</a>上，但是数据本身的组织结构不可能完全满足各种数据结构（例如，理论上不可能同时将两列都按顺序进行组织），所以，在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法。这种数据结构，就是索引。<br>看一个例子：</p>
<p><img src="https://upload-images.jianshu.io/upload_images/5687393-d10b611e15cf2ac6.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp" alt=""></p>
<p>图1.png  </p>
<p>图1展示了一种可能的索引方式。左边是数据表，一共有两列七条记录，最左边的是数据记录的物理地址（注意逻辑上相邻的记录在磁盘上也并不是一定物理相邻的）。为了加快Col2的查找，可以维护一个右边所示的二叉查找树，每个节点分别包含索引键值和一个指向对应数据记录物理地址的指针，这样就可以运用二叉查找在O(log2n)的复杂度内获取到相应数据。  </p>
<p>虽然这是一个货真价实的索引，但是实际的数据库系统几乎没有使用二叉查找树或其进化品种<a href="https://link.jianshu.com/?t=http://en.wikipedia.org/wiki/Red-black_tree" target="_blank" rel="noopener">红黑树</a>（red-black tree）实现的，原因会在下文介绍。</p>
<h1 id="B-Tree和B-Tree"><a href="#B-Tree和B-Tree" class="headerlink" title="B-Tree和B+Tree"></a>B-Tree和B+Tree</h1><p>目前大部分数据库系统及文件系统都采用B-Tree或其变种B+Tree作为索引结构，在本文的下一节会结合存储器原理及计算机存取原理讨论为什么B-Tree和B+Tree在被如此广泛用于索引，这一节先单纯从数据结构角度描述它们。</p>
<h2 id="B-Tree"><a href="#B-Tree" class="headerlink" title="B-Tree"></a>B-Tree</h2><p>是一种多路搜索树（并不是二叉的）：<br>1.定义任意非叶子结点最多只有M个儿子；且M&gt;2；<br>2.根结点的儿子数为[2, M]；<br>3.除根结点以外的非叶子结点的儿子数为[M/2, M]；<br>4.每个结点存放至少M/2-1（取上整）和至多M-1个关键字；（至少2个关键字）<br>5.非叶子结点的关键字个数=指向儿子的指针个数-1；<br>6.非叶子结点的关键字：K[1], K[2], …, K[M-1]；且K[i] &lt; K[i+1]；<br>7.非叶子结点的指针：P[1], P[2], …, P[M]；其中P[1]指向关键字小于K[1]的<br>子树，P[M]指向关键字大于K[M-1]的子树，其它P[i]指向关键字属于(K[i-1], K[i])的子树；<br>8.所有叶子结点位于同一层；<br>9.每个k对应一个data。<br>如：（M=3）相当于一个2–3树，2–3树是一个这样的一棵树， 它的每个节点要么有2个孩子和1个数据元素，要么有3个孩子和2个数据元素，叶子节点没有孩子，并且有1个或2个数据元素。  </p>
<p><img src="https://upload-images.jianshu.io/upload_images/5687393-b2a7f4a75a657b0b.JPG?imageMogr2/auto-orient/strip%7CimageView2/2/w/624/format/webp" alt=""></p>
<p>B-树的搜索，从根结点开始，对结点内的关键字（有序）序列进行二分查找，如果命中则结束，否则进入查询关键字所属范围的儿子结点；重复，直到所对应的儿子指针为空，或已经是叶子结点；B-Tree上查找算法的伪代码如下：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">BTree_Search(node, key)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (node == null)</span><br><span class="line">        <span class="keyword">return</span> null;</span><br><span class="line">    foreach (node.key)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (node.key[i] == key)</span><br><span class="line">            <span class="keyword">return</span> node.data[i];</span><br><span class="line">        <span class="keyword">if</span> (node.key[i] &gt; key)</span><br><span class="line">            <span class="keyword">return</span> BTree_Search(point[i]-&gt;node);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> BTree_Search(point[i + <span class="number">1</span>]-&gt;node);</span><br><span class="line">&#125;</span><br><span class="line">data = BTree_Search(root, my_key);</span><br></pre></td></tr></table></figure>
<ul>
<li><p>B-树的特性：<br>  1.关键字集合分布在整颗树中；<br>  2.任何一个关键字出现且只出现在一个结点中；<br>  3.搜索有可能在非叶子结点结束；<br>  4.其搜索性能等价于在关键字全集内做一次二分查找；<br>  5.自动层次控制；</p>
</li>
<li><p>B-树的自控制:<br>  B树中每一个内部节点会包含一定数量的键值。通常，键值的数量被选定在d和2d之间。在实际中，键值占用了节点中大部分的空间。因数2将保证节点可以被拆分或组合。如果一个内部节点有2d个键值，那么添加一个键值给此节点的过程，将会拆分2d键值为2个d键值的节点，并把此键值添加给父节点。每一个拆分的节点需要最小数目的键值。相似地，如果一个内部节点和他的邻居两者都有d个键值，那么将通过它与邻居的合并来删除一个键值。删除此键值将导致此节点拥有d-1个键值;与邻居的合并则加上d个键值，再加上从邻居节点的父节点移来的一个键值。结果为完全填充的2d个键值。</p>
</li>
<li><p>B-树的构造过程：<br>  下面是往B树中依次插入<br>  6 10 4 14 5 11 15 3 2 12 1 7 8 8 6 3 6 21 5 15 15 6 32 23 45 65 7 8 6 5 4  </p>
<p>  <img src="https://upload-images.jianshu.io/upload_images/5687393-9d5d95ce7c3b42f4.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/958/format/webp" alt=""></p>
<p>  btreebuild.gif</p>
</li>
</ul>
<h2 id="B-Tree-1"><a href="#B-Tree-1" class="headerlink" title="B+Tree"></a>B+Tree</h2><p>B-Tree有许多变种，其中最常见的是B+Tree，例如MySQL就普遍使用B+Tree实现其索引结构。</p>
<ul>
<li><p>与B-Tree相比，B+Tree有以下不同点：<br>  1.非叶子结点的子树指针与关键字个数相同；<br>  2.非叶子结点的子树指针P[i]，指向关键字值属于[K[i], K[i+1])的子树（B-树是开区间）；<br>  3.为所有叶子结点增加一个链指针；<br>  4.所有关键字都在叶子结点出现；<br>  5.内节点不存储data，只存储key<br>  如：（M=3）  </p>
<p>  <img src="https://upload-images.jianshu.io/upload_images/5687393-717ab97b31dfa84b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/569/format/webp" alt=""></p>
<p>  Paste_Image.png</p>
</li>
</ul>
<p>B+的搜索与B-树也基本相同，区别是B+树只有达到叶子结点才命中（B-树可以在非叶子结点命中），其性能也等价于在关键字全集做一次二分查找；</p>
<ul>
<li><p>B+的特性：<br>  1.所有关键字都出现在叶子结点的链表中（稠密索引），且链表中的关键字恰好是有序的；<br>  2.不可能在非叶子结点命中；<br>  3.非叶子结点相当于是叶子结点的索引（稀疏索引），叶子结点相当于是存储（关键字）数据的数据层；<br>  4.更适合文件索引系统；</p>
</li>
<li><p>B+树的构造过程：<br>  下面是往B+树中依次插入<br>  6 10 4 14 5 11 15 3 2 12 1 7 8 8 6 3 6 21 5 15 15 6 32 23 45 65 7 8 6 5 4  </p>
<p>  <img src="https://upload-images.jianshu.io/upload_images/5687393-59a8ea11c8555ab0.gif?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp" alt=""></p>
<p>  Bplustreebuild.gif</p>
</li>
</ul>
<h1 id="索引的物理存储"><a href="#索引的物理存储" class="headerlink" title="索引的物理存储"></a>索引的物理存储</h1><p>一般来说，索引本身也很大，不可能全部存储在内存中，因此索引往往以索引文件的形式存储的磁盘上。这样的话，索引查找过程中就要产生磁盘I/O消耗，相对于内存存取，I/O存取的消耗要高几个数量级，所以评价一个数据结构作为索引的优劣最重要的指标就是在查找过程中磁盘I/O操作次数的渐进复杂度。换句话说，索引的结构组织要尽量减少查找过程中磁盘I/O的存取次数。</p>
<h2 id="B-tree"><a href="#B-tree" class="headerlink" title="B-tree"></a>B-tree</h2><p><img src="https://upload-images.jianshu.io/upload_images/5687393-deb292ed3e4bf18c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp" alt=""></p>
<p>Paste_Image.png  </p>
<p>假如每个盘块可以正好存放一个B树的结点（正好存放2个文件名）。那么一个BTNODE结点就代表一个盘块，而子树指针就是存放另外一个盘块的地址。</p>
<ul>
<li><p>下面，咱们来模拟下查找文件29的过程：  </p>
<p>  1.根据根结点指针找到文件目录的根磁盘块1，将其中的信息导入内存。【磁盘IO操作 1次】  </p>
<p>  2.此时内存中有两个文件名17、35和三个存储其他磁盘页面地址的数据。根据算法我们发现：17&lt;29&lt;35，因此我们找到指针p2。  </p>
<p>  3.根据p2指针，我们定位到磁盘块3，并将其中的信息导入内存。【磁盘IO操作 2次】  </p>
<p>  4.此时内存中有两个文件名26，30和三个存储其他磁盘页面地址的数据。根据算法我们发现：26&lt;29&lt;30，因此我们找到指针p2。  </p>
<p>  5.根据p2指针，我们定位到磁盘块8，并将其中的信息导入内存。【磁盘IO操作 3次】  </p>
<p>  6.此时内存中有两个文件名28，29。根据算法我们查找到文件名29，并定位了该文件内存的磁盘地址。  </p>
<p>  分析上面的过程，发现需要3次磁盘IO操作和3次内存查找操作。关于内存中的文件名查找，由于是一个有序表结构，可以利用折半查找提高效率。至于IO操作是影响整个B树查找效率的决定因素。</p>
</li>
</ul>
<p>当然，如果我们使用平衡二叉树的磁盘存储结构来进行查找，磁盘4次，最多5次，而且文件越多，B树比平衡二叉树所用的磁盘IO操作次数将越少，效率也越高。</p>
<h2 id="B-tree-1"><a href="#B-tree-1" class="headerlink" title="B+tree"></a>B+tree</h2><p><img src="https://upload-images.jianshu.io/upload_images/5687393-717ab97b31dfa84b.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/569/format/webp" alt=""></p>
<p>Paste_Image.png</p>
<ul>
<li>B+tree的优点：</li>
</ul>
<ol>
<li><p>B+-tree的磁盘读写代价更低  </p>
<p>*<strong>*B+-tree**</strong>的内部结点并没有指向关键字具体信息的指针。因此其内部结点相对B 树更小。如果把所有同一内部结点的关键字存放在同一盘块中，那么盘块所能容纳的关键字数量也越多。一次性读入内存中的需要查找的关键字也就越多。相对来说IO读写次数也就降低了。  </p>
<p>举个例子，假设磁盘中的一个盘块容纳16bytes，而一个关键字2bytes，一个关键字具体信息指针2bytes。一棵9阶B-tree(一个结点最多8个关键字)的内部结点需要2个盘快。而<em>**</em>B+  </p>
<p>*<strong>*树内部结点只需要1个盘快。当需要把内部结点读入内存中的时候，B 树就比**</strong>B+ <em>**</em>树多一次盘块查找时间(在磁盘中就是盘片旋转的时间)。</p>
</li>
<li><p>B+-tree的查询效率更加稳定  </p>
<p>由于非终结点并不是最终指向文件内容的结点，而只是叶子结点中关键字的索引。所以任何关键字的查找必须走一条从根结点到叶子结点的路。所有关键字查询的路径长度相同，导致每一个数据的查询效率相当。</p>
</li>
</ol>
<h1 id="mysql的两种存储引擎的索引存储机制"><a href="#mysql的两种存储引擎的索引存储机制" class="headerlink" title="mysql的两种存储引擎的索引存储机制"></a>mysql的两种存储引擎的索引存储机制</h1><h2 id="MyISAM索引实现"><a href="#MyISAM索引实现" class="headerlink" title="MyISAM索引实现"></a>MyISAM索引实现</h2><p>MyISAM引擎使用B+Tree作为索引结构，叶节点的data域存放的是数据记录的地址。下图是MyISAM索引的原理图：  </p>
<p><img src="https://upload-images.jianshu.io/upload_images/5687393-942f8ec950b81e79.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp" alt=""></p>
<p>Paste_Image.png  </p>
<p>这里设表一共有三列，假设我们以Col1为主键，则上图是一个MyISAM表的主索引（Primary key）示意。可以看出MyISAM的索引文件仅仅保存数据记录的地址。在MyISAM中，主索引和辅助索引（Secondary key）在结构上没有任何区别，只是主索引要求key是唯一的，而辅助索引的key可以重复。如果我们在Col2上建立一个辅助索引，则此索引的结构如下图所示：  </p>
<p><img src="https://upload-images.jianshu.io/upload_images/5687393-99c73161973f6c2f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp" alt=""></p>
<p>Paste_Image.png  </p>
<p>同样也是一颗B+Tree，data域保存数据记录的地址。因此，MyISAM中索引检索的算法为首先按照B+Tree搜索算法搜索索引，如果指定的Key存在，则取出其data域的值，然后以data域的值为地址，读取相应数据记录。  </p>
<p>MyISAM的索引方式也叫做“非聚集”的。</p>
<h2 id="InnoDB索引实现"><a href="#InnoDB索引实现" class="headerlink" title="InnoDB索引实现"></a>InnoDB索引实现</h2><p>虽然InnoDB也使用B+Tree作为索引结构，但具体实现方式却与MyISAM截然不同。</p>
<p>第一个重大区别是InnoDB的数据文件本身就是索引文件。从上文知道，MyISAM索引文件和数据文件是分离的，索引文件仅保存数据记录的地址。而在InnoDB中，表数据文件本身就是按B+Tree组织的一个索引结构，这棵树的叶节点data域保存了完整的数据记录。这个索引的key是数据表的主键，因此InnoDB表数据文件本身就是主索引。  </p>
<p><img src="https://upload-images.jianshu.io/upload_images/5687393-f7686f5fd8dc3c43.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp" alt=""></p>
<p>Paste_Image.png  </p>
<p>上图是InnoDB主索引（同时也是数据文件）的示意图，可以看到叶节点包含了完整的数据记录。这种索引叫做聚集索引。因为InnoDB的数据文件本身要按主键聚集，所以InnoDB要求表必须有主键（MyISAM可以没有），如果没有显式指定，则MySQL系统会自动选择一个可以唯一标识数据记录的列作为主键，如果不存在这种列，则MySQL自动为InnoDB表生成一个隐含字段作为主键，这个字段长度为6个字节，类型为长整形。</p>
<p>第二个与MyISAM索引的不同是InnoDB的辅助索引data域存储相应记录主键的值而不是地址。换句话说，InnoDB的所有辅助索引都引用主键作为data域。例如，定义在Col3上的一个辅助索引：  </p>
<p><img src="https://upload-images.jianshu.io/upload_images/5687393-a816c1e214faecb2.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1000/format/webp" alt=""></p>
<p>Paste_Image.png  </p>
<p>这里以英文字符的ASCII码作为比较准则。聚集索引这种实现方式使得按主键的搜索十分高效，但是辅助索引搜索需要检索两遍索引：首先检索辅助索引获得主键，然后用主键到主索引中检索获得记录。</p>
<p>了解不同存储引擎的索引实现方式对于正确使用和优化索引都非常有帮助，例如知道了InnoDB的索引实现后，就很容易明白为什么不建议使用过长的字段作为主键，因为所有辅助索引都引用主索引，过长的主索引会令辅助索引变得过大。再例如，用非单调的字段作为主键在InnoDB中不是个好主意，因为InnoDB数据文件本身是一颗B+Tree，非单调的主键会造成在插入新记录时数据文件为了维持B+Tree的特性而频繁的分裂调整，十分低效，而使用自增字段作为主键则是一个很好的选择。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://lamborghini1993.github.io/LeetCode/LeetCode/LeetCode-032-longest-valid-parentheses/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="XiaoHao">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/picture/Head.png">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiao❤Hao">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/LeetCode/LeetCode/LeetCode-032-longest-valid-parentheses/" itemprop="url">LeetCode-032-longest-valid-parentheses</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-01-28T17:34:35+08:00">
                2019-01-28
              </time>
            

            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing">
                  <a href="/categories/LeetCode/" itemprop="url" rel="index">
                    <span itemprop="name">LeetCode</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/LeetCode/LeetCode/LeetCode-032-longest-valid-parentheses/" class="leancloud_visitors" data-flag-title="LeetCode-032-longest-valid-parentheses">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="题目地址"><a href="#题目地址" class="headerlink" title="题目地址"></a>题目地址</h1><ul>
<li>英文：<a href="https://leetcode.com/problems/longest-valid-parentheses/" target="_blank" rel="noopener">https://leetcode.com/problems/longest-valid-parentheses/</a></li>
<li>中文：<a href="https://leetcode-cn.com/problems/longest-valid-parentheses/" target="_blank" rel="noopener">https://leetcode-cn.com/problems/longest-valid-parentheses/</a></li>
</ul>
<h1 id="题意："><a href="#题意：" class="headerlink" title="题意："></a>题意：</h1><p>给定一个只包含 ‘(‘ 和 ‘)’ 的字符串，找出最长的包含有效括号的子串的长度。</p>
<p>示例 1:</p>
<p>输入: “(()”<br>输出: 2<br>解释: 最长有效括号子串为 “()”</p>
<p>示例 2:</p>
<p>输入: “)()())”<br>输出: 4<br>解释: 最长有效括号子串为 “()()”</p>
<h1 id="解题思路："><a href="#解题思路：" class="headerlink" title="解题思路："></a>解题思路：</h1><ul>
<li>看到括号匹配立即想到栈，<code>(</code>入栈，<code>)</code>则出栈；</li>
<li>要求最长有效括号子串长度，则求连续有效括号长度；</li>
<li>出栈之后将本位置，以及栈顶位置标记为<code>true</code>；</li>
<li>求最大连续为true的长度。</li>
<li>PS:注意这里没说输入字符串最长数组多大，测试至少有9999位</li>
</ul>
<!--c++0-->
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;climits&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">bool</span> Visit[<span class="number">99999</span>];</span><br><span class="line"><span class="keyword">int</span> j, cnt;</span><br><span class="line"><span class="keyword">int</span> result = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">  <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">longestValidParentheses</span><span class="params">(<span class="built_in">string</span> s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="built_in">stack</span>&lt;<span class="keyword">int</span>&gt; my;</span><br><span class="line">        cnt = result = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Visit[i] = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (s[i] == <span class="string">'('</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                my.push(i);</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!my.empty())</span><br><span class="line">            &#123;</span><br><span class="line">                j = my.top();</span><br><span class="line">                my.pop();</span><br><span class="line">                Visit[j] = <span class="literal">true</span>;</span><br><span class="line">                Visit[i] = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s.length(); i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Visit[i])</span><br><span class="line">            &#123;</span><br><span class="line">                cnt++;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            result = max(result, cnt);</span><br><span class="line">            cnt = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        result = max(result, cnt);</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"结果为:%d\n"</span>, result);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">// int main(int argc, char const *argv[])</span></span><br><span class="line"><span class="comment">// &#123;</span></span><br><span class="line"><span class="comment">//     string s1 = ")(";</span></span><br><span class="line"><span class="comment">//     Solution().longestValidParentheses(s1);</span></span><br><span class="line"><span class="comment">//     return 0;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<h1 id="github"><a href="#github" class="headerlink" title="github"></a>github</h1><ul>
<li><a href="https://github.com/lamborghini1993/LeetCode" target="_blank" rel="noopener">https://github.com/lamborghini1993/LeetCode</a></li>
</ul>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/picture/Head.png" alt="XiaoHao">
            
              <p class="site-author-name" itemprop="name">XiaoHao</p>
              <p class="site-description motion-element" itemprop="description">人生苦短、我用python</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">31</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">14</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/lamborghini1993" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="https://blog.csdn.net/xh_reventon" target="_blank" title="CSDN">
                      
                        <i class="fa fa-fw fa-twitter"></i>CSDN</a>
                  </span>
                
            </div>
          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">XiaoHao</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Pisces</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("xO8AfCMOcVBcJsQlSpcxta7h-gzGzoHsz", "fux0nAIKeK8hj5Be7CVWIhBJ");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
